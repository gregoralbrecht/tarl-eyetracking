(function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.neo4j"),sigma.utils.pkg("sigma.utils"),sigma.neo4j.send=function(e,t,a,n,s){var o,i,r,d=sigma.utils.xhr();if(o=e,"object"==typeof e&&(o=e.url,i=e.user,r=e.password),!d)throw"XMLHttpRequest not supported, cannot load the file.";o+=t,d.open(a,o,!0),i&&r&&d.setRequestHeader("Authorization","Basic "+btoa(i+":"+r)),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("Content-type","application/json; charset=utf-8"),d.onreadystatechange=function(){4===d.readyState&&s(JSON.parse(d.responseText))},d.send(n)},sigma.neo4j.cypher_parse=function(e){var t,a={nodes:[],edges:[]},n={},s={};e.results[0].data.forEach(function(e){e.graph.nodes.forEach(function(e){var t={id:e.id,label:e.id,x:Math.random(),y:Math.random(),size:1,color:"#000000",neo4j_labels:e.labels,neo4j_data:e.properties};t.id in n||(n[t.id]=t)}),e.graph.relationships.forEach(function(e){var t={id:e.id,label:e.type,source:e.startNode,target:e.endNode,color:"#7D7C8E",neo4j_type:e.type,neo4j_data:e.properties};t.id in s||(s[t.id]=t)})});for(t in n)a.nodes.push(n[t]);for(t in s)a.edges.push(s[t]);return a},sigma.neo4j.cypher=function(e,t,a,n){var s,o,i="/db/data/transaction/commit";s=JSON.stringify({statements:[{statement:t,resultDataContents:["graph"],includeStats:!1}]}),o=function(e){return function(t){var n={nodes:[],edges:[]};n=sigma.neo4j.cypher_parse(t),a instanceof sigma?(a.graph.clear(),a.graph.read(n)):"object"==typeof a?(a=new sigma(a),a.graph.read(n),a.refresh()):"function"==typeof a&&(e=a,a=null),e&&e(a||n)}},sigma.neo4j.send(e,i,"POST",s,o(n))},sigma.neo4j.getLabels=function(e,t){sigma.neo4j.send(e,"/db/data/labels","GET",null,t)},sigma.neo4j.getTypes=function(e,t){sigma.neo4j.send(e,"/db/data/relationship/types","GET",null,t)}}).call(this);