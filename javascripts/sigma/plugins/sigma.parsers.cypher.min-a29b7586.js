(function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.neo4j"),sigma.utils.pkg("sigma.utils"),sigma.utils.pkg("sigma.parsers"),sigma.neo4j.send=function(e,t,a,s,n){var i,o,r,d=sigma.utils.xhr();if(i=e,"object"==typeof e&&(i=e.url,o=e.user,r=e.password),!d)throw"XMLHttpRequest not supported, cannot load the file.";i+=t,d.open(a,i,!0),o&&r&&d.setRequestHeader("Authorization","Basic "+btoa(o+":"+r)),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("Content-type","application/json; charset=utf-8"),d.onreadystatechange=function(){4===d.readyState&&n(JSON.parse(d.responseText))},d.send(s)},sigma.neo4j.cypher_parse=function(e){var t,a={nodes:[],edges:[]},s={},n={};e.results[0].data.forEach(function(e){e.graph.nodes.forEach(function(e){var t={id:e.id,label:e.id,x:Math.random(),y:Math.random(),size:1,color:"#000000",neo4j_labels:e.labels,neo4j_data:e.properties};t.id in s||(s[t.id]=t)}),e.graph.relationships.forEach(function(e){var t={id:e.id,label:e.type,source:e.startNode,target:e.endNode,color:"#7D7C8E",neo4j_type:e.type,neo4j_data:e.properties};t.id in n||(n[t.id]=t)})});for(t in s)a.nodes.push(s[t]);for(t in n)a.edges.push(n[t]);return a},sigma.neo4j.cypher=function(e,t,a,s){var n,i,o="/db/data/transaction/commit";n=JSON.stringify({statements:[{statement:t,resultDataContents:["graph"],includeStats:!1}]}),i=function(e){return function(t){var s={nodes:[],edges:[]};s=sigma.neo4j.cypher_parse(t),a instanceof sigma?(a.graph.clear(),a.graph.read(s)):"object"==typeof a?(a=new sigma(a),a.graph.read(s),a.refresh()):"function"==typeof a&&(e=a,a=null),e&&e(a||s)}},sigma.neo4j.send(e,o,"POST",n,i(s))},sigma.neo4j.getLabels=function(e,t){sigma.neo4j.send(e,"/db/data/labels","GET",null,t)},sigma.neo4j.getTypes=function(e,t){sigma.neo4j.send(e,"/db/data/relationship/types","GET",null,t)}}).call(this);